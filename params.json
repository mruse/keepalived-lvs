{"name":"Keepalived-lvs","tagline":"","body":"# /etc/keepalived/keepalived.conf\r\n# 完整的 keepalived 配置文件由3部分组成：全局定义部分，vrrp实例定义部分，虚拟服务器定义部分\r\n\r\nvrrp_instance VI_1 {\r\n! Configuration File for keepalived\r\n# 全局定义部分\r\nglobal_defs {\r\n   notification_email {\r\n\ttest1@163.com\t# 设置报警邮件地址，可设置多个\r\n\ttest2@163.com\t# 每行1个; 开启邮件报警，需要开启本机 sendmail 服务\r\n   }\r\n   notification_email_from test0@163.com \t# 设置 邮件的发送地址\r\n   smtp_server smtp.163.com\t\t\t\t \t# 设置 smtp server 地址\r\n   smtp_connect_timeout 30\t\t\t\t\t# 设置 连接 smtp server的超时时间\r\n   router_id LVS_DEVEL-1\t\t\t\t\t# 设置 keepalived 服务器的一个标识。发邮件时显示在邮件主题中的信息\r\n}\r\n# vrrp 实例部分定义\r\nvrrp_instance VI_1 {\r\n    state BACKUP\t\t\t\t\t\t\t# 指定 keepalived 的角色，可选值：MASTER|BACKUP 分别表示（主|备）\r\n    interface eth0\t\t\t\t\t\t\t# 指定 HA 检测网络的接口\r\n    virtual_router_id 51\t\t\t\t\t# 虚拟路由表示，是一个数字，同一个vrrp 实例使用唯一的标识\r\n\t\t\t\t\t\t\t\t\t\t\t# MASTER和BACKUP 的 同一个 vrrp_instance 下 这个标识必须保持一致\r\n    priority 100\t\t\t\t\t\t\t# 定义优先级，数字越大，优先级越高。\r\n\t\t\t\t\t\t\t\t\t\t\t# 同一个 vrrp_instance 下，MASTER 优先级必须大于 BACKUP\r\n    advert_int 1\t\t\t\t\t\t\t# 设定 MASTER 与 BACKUP 负载均衡之间同步检查的时间间隔，单位为秒\r\n    authentication {\t\t\t\t\t\t# 设置验证类型和密码\r\n        auth_type PASS\t\t\t\t\t\t# 设定验证类型，主要有: PASS 和 AH 两种\r\n        auth_pass 1111\t\t\t\t\t\t# 设置验证密码，在一个 vrrp_instance 下, MASTER 和 BACKUP必须使用相同的密码才能通信\r\n    }\r\n    virtual_ipaddress {\t\t\t\t\t\t# 设置虚拟IP地址，可以设置多个虚拟IP地址，每行一个\r\n        192.168.200.16\r\n        192.168.200.17\r\n        192.168.200.18\r\n    }\r\n}\r\n# 虚拟服务器定义部分\r\nvirtual_server 192.168.200.100 443 {\t# 设置虚拟服务器需要指定虚拟IP地址和服务端口，IP和端口之间用空格隔开\r\n    delay_loop 6\t\t\t\t\t\t# 设置运行情况检查，\r\n    lb_algo rr\t\t\t\t\t\t\t# 设置负载均衡调度算法，这里设置为rr, 即轮询算法\r\n    lb_kind NAT\t\t\t\t\t\t\t# 设置LVS实现负载均衡的机制，有 NAT，TUN和DR三个模式可选\r\n    nat_mask 255.255.255.0\r\n    persistence_timeout 50\t\t\t\t# 会话保持时间，单位是秒。这个选项对动态网页比较有用，为集群系统中的session共享提供了很好的解决方案\r\n\t\t\t\t\t\t\t\t\t\t# 用户请求会一直发布到某个服务节点，知道超过这个会话的保持时间。\r\n\t\t\t\t\t\t\t\t\t\t# 需要注意，这个会话保持时间是最大无响应超时时间，即，用户在操作动态页面是，指定描述内无任何操作\r\n\t\t\t\t\t\t\t\t\t\t# 则接下来的操作会被分发到其他节点，若一直操作则不受该设置限制\r\n    protocol TCP\t\t\t\t\t\t# 指定转发协议类型，有TCP和UDP\r\n\r\n    real_server 192.168.201.100 443 {\t# 配置服务节点需要指定 real_server 的真实IP地址和端口，IP与端口之间用空格隔开\r\n        weight 1\t\t\t\t\t\t# 配置服务节点的权值，权值大小用数字表示，数字越大，权值越高\r\n\t\t\t\t\t\t\t\t\t\t# 设置权值的大小可以为不同性能的服务器分配不同的负载，可以为性能搞的服务器设置较高的权值，\r\n\t\t\t\t\t\t\t\t\t\t# 性能低的设置相对低的权值\r\n\t\tTCP_CHECK {\r\n\t\t\tconnect_timeout 3\r\n\t\t\tnb_get_retry 3\r\n\t\t\tdelay_before_retry 3\r\n\t\t}\t\t\t\t\t\t\t\t\r\n\t\t\r\n        SSL_GET {\r\n            url {\r\n              path /\r\n              digest ff20ad2481f97b1754ef3e12ecd3a9cc\r\n            }\r\n            url {\r\n              path /mrtg/\r\n              digest 9b3a0c85a887a256d6939da88aabd8cd\r\n            }\r\n            connect_timeout 3\r\n            nb_get_retry 3\r\n            delay_before_retry 3\r\n        }\r\n    }\r\n}\r\n\r\nvirtual_server 10.10.10.2 1358 {\r\n    delay_loop 6\r\n    lb_algo rr\r\n    lb_kind NAT\r\n    persistence_timeout 50\r\n    protocol TCP\r\n\r\n    sorry_server 192.168.200.200 1358\r\n\r\n    real_server 192.168.200.2 1358 {\r\n        weight 1\r\n        HTTP_GET {\r\n            url {\r\n              path /testurl/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            url {\r\n              path /testurl2/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            url {\r\n              path /testurl3/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            connect_timeout 3\r\n            nb_get_retry 3\r\n            delay_before_retry 3\r\n        }\r\n    }\r\n\r\n    real_server 192.168.200.3 1358 {\r\n        weight 1\r\n        HTTP_GET {\r\n            url {\r\n              path /testurl/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334c\r\n            }\r\n            url {\r\n              path /testurl2/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334c\r\n            }\r\n            connect_timeout 3\r\n            nb_get_retry 3\r\n            delay_before_retry 3\r\n        }\r\n    }\r\n}\r\n\r\nvirtual_server 10.10.10.3 1358 {\r\n    delay_loop 3\r\n    lb_algo rr\r\n    lb_kind NAT\r\n    nat_mask 255.255.255.0\r\n    persistence_timeout 50\r\n    protocol TCP\r\n\r\n    real_server 192.168.200.4 1358 {\r\n        weight 1\r\n        HTTP_GET {\r\n            url {\r\n              path /testurl/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            url {\r\n              path /testurl2/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            url {\r\n              path /testurl3/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            connect_timeout 3\r\n            nb_get_retry 3\r\n            delay_before_retry 3\r\n        }\r\n    }\r\n\r\n    real_server 192.168.200.5 1358 {\r\n        weight 1\r\n        HTTP_GET {\r\n            url {\r\n              path /testurl/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            url {\r\n              path /testurl2/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            url {\r\n              path /testurl3/test.jsp\r\n              digest 640205b7b0fc66c1ea91c463fac6334d\r\n            }\r\n            connect_timeout 3\r\n            nb_get_retry 3\r\n            delay_before_retry 3\r\n        }\r\n    }\r\n}\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}